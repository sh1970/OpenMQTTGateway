.. |yes| image:: ../../../images/yes.png
.. |no| image:: ../../../images/no.png

.. role:: underline
   :class: underline

Elro HE (300 Series)
====================

+------------------+-------------+
| **Feature**      | **Support** |
+------------------+-------------+
| Sending          | |yes|       |
+------------------+-------------+
| Receiving        | |yes|       |
+------------------+-------------+
| Config           | |yes|       |
+------------------+-------------+

.. rubric:: Supported Brands

+----------------------+------------------+
| **Brand**            | **Protocol**     |
+----------------------+------------------+
| Elro 300 Series      | elro_300_switch  |
+----------------------+------------------+

.. rubric:: Sender Arguments

.. code-block:: console
   :linenos:

   -s --systemcode=systemcode     control a device with this systemcode
   -u --unitcode=unitcode         control a device with this unitcode
   -t --on                        send an on signal
   -f --off                       send an off signal
   -a --all                       trigger group switching

.. rubric:: Config

.. code-block:: json
   :linenos:

   {
     "devices": {
       "dimmer": {
         "protocol": [ "elro_300_switch" ],
         "id": [{
           "systemcode": 123456,
           "unitcode": 0
         }],
         "state": "off"
       }
     },
     "gui": {
       "Lamp": {
         "name": "TV Backlit",
         "group": [ "Living" ],
         "media": [ "all" ]
       }
     }
   }

+------------------+-----------------+
| **Option**       | **Value**       |
+------------------+-----------------+
| systemcode       | 0 - 4294967295  |
+------------------+-----------------+
| unitcode         | 0 - 99          |
+------------------+-----------------+
| state            | on / off        |
+------------------+-----------------+

.. rubric:: Optional Settings

:underline:`Device Settings`

+----------------------+-------------+------------+------------------------------------------------------------+
| **Setting**          | **Default** | **Format** | **Description**                                            |
+----------------------+-------------+------------+------------------------------------------------------------+
| all                  | 1           | 1 or 0     | | If specified this will trigger the **group** function of |
|                      |             |            | | the advanced remotes and trigger all registered devices  |
|                      |             |            | | for the given Systemcode                                 |
+----------------------+-------------+------------+------------------------------------------------------------+

:underline:`GUI Settings`

+----------------------+-------------+------------+-----------------------------------------------------------+
| **Setting**          | **Default** | **Format** | **Description**                                           |
+----------------------+-------------+------------+-----------------------------------------------------------+
| readonly             | 1           | 1 or 0     | Disable controlling this device from the GUIs             |
+----------------------+-------------+------------+-----------------------------------------------------------+
| confirm              | 1           | 1 or 0     | Ask for confirmation when switching device                |
+----------------------+-------------+------------+-----------------------------------------------------------+

.. Note::

   The group button appears to be sending the unitcode of I-1 (First band, first unit) no matter to which band the remote is currently set.

.. rubric:: Protocol

This protocol sends 116 pulses like this

.. code-block:: console

   302 1208 302 1208 302 302 302 302 302 302 302 1208 302 1208 302 1208 302 1208 302 302 302 302 302 1208 302 302 302 1208 302 1208 302 1208 302 1208 302 302 302 302 302 1208 302 302 302 1208 302 1208 302 302 302 302 302 1208 302 302 302 1208 302 1208 302 1208 302 1208 302 302 302 302 302 1208 302 1208 302 302 302 1208 302 1208 302 302 302 302 302 1208 302 302 302 1208 302 1208 302 302 302 1208 302 1208 302 302 302 1208 302 302 302 1208 302 302 302 302 302 1208 302 1208 302 1208 302 302 302 10268

These pulses are separated into groups of 2:

.. code-block:: console

   302 1208
   302 1208
   302 302
   302 302
   302 302
   302 1208
   302 1208
   302 1208
   302 1208
   302 302
   302 302
   302 1208
   302 302
   302 1208
   302 1208
   302 1208
   302 1208
   302 302
   302 302
   302 1208
   302 302
   302 1208
   302 1208
   302 302
   302 302
   302 1208
   302 302
   302 1208
   302 1208
   302 1208
   302 1208
   302 302
   302 302
   302 1208
   302 1208
   302 302
   302 1208
   302 1208
   302 302
   302 302
   302 1208
   302 302
   302 1208
   302 1208
   302 302
   302 1208
   302 1208
   302 302
   302 1208
   302 302
   302 1208
   302 302
   302 302
   302 1208
   302 1208
   302 1208
   302 302
   302 10268

There are several easily identifiable facts here:

- ``320 960 320 960``
- ``320 960 960 320``

#. The baseline is at 302
#. The high Pulse is basline * 4 = 1208
#. The last 2-pulse sequence is special, it's the footer of the message

Using a translation pattern of **302 1208** → 1 and **302 302** → 0 we translate this sequence into the following pattern

.. code-block::console

   1100011110010111100101100101111001101100101101101010011101

Testing and some outside info reveals the following sections:

.. code-block: console

   AAAAAAAAAAABBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBCCCCDDEEFFFFFFG

   A = Startbits/preamble
   B = Address            (32 Bit system code)
   C = Group Code         (Grouped: 1100, Non-Grouped: 1011)
   D = Command,           (On: 01, Off: 10)
   E = Group Code 2       (Grouped: 11, Non Grouped: 01)
   F = UnitCode
   G = Stopbit

So this code represents:

- SystemCode: 3165844325
- UnitCode: 28
- State: Off
- UnitCode: NotSet

The protocol filters out false positives by checking if:

#. Every 1st pulse in groups of 2 is a low pulse
#. The last two pulses are 302 and 10268 (fixed footer)

This is the readout from the writer's reference HE300 remote

+----------+----------+--------------+------------+------------+
| **Band** | **Code** | **UnitCode** | **GroupA** | **GroupB** |
+----------+----------+--------------+------------+------------+
| I        | 1        | 56           | 13         | 2          |
+----------+----------+--------------+------------+------------+
| I        | 2        | 52           | 13         | 2          |
+----------+----------+--------------+------------+------------+
| I        | 3        | 44           | 13         | 2          |
+----------+----------+--------------+------------+------------+
| I        | 4        | 28           | 13         | 2          |
+----------+----------+--------------+------------+------------+
| II       | 1        | 50           | 13         | 2          |
+----------+----------+--------------+------------+------------+
| II       | 2        | 42           | 13         | 2          |
+----------+----------+--------------+------------+------------+
| II       | 3        | 26           | 13         | 2          |
+----------+----------+--------------+------------+------------+
| II       | 4        | 38           | 13         | 2          |
+----------+----------+--------------+------------+------------+
| III      | 1        | 22           | 13         | 2          |
+----------+----------+--------------+------------+------------+
| III      | 2        | 14           | 13         | 2          |
+----------+----------+--------------+------------+------------+
| III      | 3        | 49           | 13         | 2          |
+----------+----------+--------------+------------+------------+
| III      | 4        | 41           | 13         | 2          |
+----------+----------+--------------+------------+------------+
| IV       | 1        | 25           | 13         | 2          |
+----------+----------+--------------+------------+------------+
| IV       | 2        | 37           | 13         | 2          |
+----------+----------+--------------+------------+------------+
| IV       | 3        | 21           | 13         | 2          |
+----------+----------+--------------+------------+------------+
| IV       | 4        | 13           | 13         | 2          |
+----------+----------+--------------+------------+------------+

This is translated:

.. code-block:: console

   1-1 11000111100 10111100101100101111001101100101 1011 10 01 000111 1
   1-2 11000111100 10111100101100101111001101100101 1011 10 01 001011 1
   1-3 11000111100 10111100101100101111001101100101 1011 10 01 001101 1
   1-4 11000111100 10111100101100101111001101100101 1011 10 01 001110 1
   2-1 11000111100 10111100101100101111001101100101 1011 10 01 010011 1
   2-2 11000111100 10111100101100101111001101100101 1011 10 01 010101 1
   2-3 11000111100 10111100101100101111001101100101 1011 10 01 010110 1
   2-4 11000111100 10111100101100101111001101100101 1011 10 01 011001 1
   3-1 11000111100 10111100101100101111001101100101 1011 10 01 011010 1
   3-2 11000111100 10111100101100101111001101100101 1011 10 01 011100 1
   3-3 11000111100 10111100101100101111001101100101 1011 10 01 100011 1
   3-4 11000111100 10111100101100101111001101100101 1011 10 01 100101 1
   4-1 11000111100 10111100101100101111001101100101 1011 10 01 100110 1
   4-2 11000111100 10111100101100101111001101100101 1011 10 01 101001 1
   4-3 11000111100 10111100101100101111001101100101 1011 10 01 101010 1
   4-4 11000111100 10111100101100101111001101100101 1011 10 01 101100 1

   G1  11000111100 10111100101100101111001101100101 1100 10 11 000111 1
   G2  11000111100 10111100101100101111001101100101 1100 10 11 000111 1
   G3  11000111100 10111100101100101111001101100101 1100 10 11 000111 1
   G4  11000111100 10111100101100101111001101100101 1100 10 11 000111 1
