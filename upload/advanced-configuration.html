<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Advanced configuration of the gateway | OpenMQTTGateway v1.7.0</title>
    <meta name="generator" content="VuePress 1.9.8">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="icon" href="/img/Openmqttgateway_logo_mini.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <script type="module" src="https://unpkg.com/esp-web-tools@3.4.2/dist/web/install-button.js?module"></script>
    <meta name="description" content="One gateway, many technologies: MQTT gateway for ESP8266, ESP32, Sonoff RF Bridge or Arduino with bidirectional 433mhz/315mhz/868mhz, Infrared communications, BLE, beacons detection, mi flora / mi jia / LYWSD02/ Mi Scale compatibility, SMS &amp; LORA.">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/favicon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.7f8e66f6.css" as="style"><link rel="preload" href="/assets/js/app.7095c86b.js" as="script"><link rel="preload" href="/assets/js/2.fdf4d158.js" as="script"><link rel="preload" href="/assets/js/24.6de3bada.js" as="script"><link rel="prefetch" href="/assets/js/10.dd089e98.js"><link rel="prefetch" href="/assets/js/100.5457fea1.js"><link rel="prefetch" href="/assets/js/101.38823a68.js"><link rel="prefetch" href="/assets/js/102.ebe550f3.js"><link rel="prefetch" href="/assets/js/103.d46d1273.js"><link rel="prefetch" href="/assets/js/104.89cfbae6.js"><link rel="prefetch" href="/assets/js/105.2b48c7ad.js"><link rel="prefetch" href="/assets/js/106.5e98a11b.js"><link rel="prefetch" href="/assets/js/107.ea8f3bf8.js"><link rel="prefetch" href="/assets/js/108.740b44ee.js"><link rel="prefetch" href="/assets/js/109.8313985b.js"><link rel="prefetch" href="/assets/js/11.b8303842.js"><link rel="prefetch" href="/assets/js/110.5add3988.js"><link rel="prefetch" href="/assets/js/111.b7478092.js"><link rel="prefetch" href="/assets/js/112.956dae4b.js"><link rel="prefetch" href="/assets/js/113.c4baa83d.js"><link rel="prefetch" href="/assets/js/114.0a4f4990.js"><link rel="prefetch" href="/assets/js/115.e95b8ca8.js"><link rel="prefetch" href="/assets/js/116.ee192294.js"><link rel="prefetch" href="/assets/js/117.e23f9919.js"><link rel="prefetch" href="/assets/js/118.8c8d109f.js"><link rel="prefetch" href="/assets/js/119.57871c89.js"><link rel="prefetch" href="/assets/js/12.506baa66.js"><link rel="prefetch" href="/assets/js/120.bfc8024a.js"><link rel="prefetch" href="/assets/js/121.fb1c0839.js"><link rel="prefetch" href="/assets/js/122.f92aa855.js"><link rel="prefetch" href="/assets/js/13.b20f61ae.js"><link rel="prefetch" href="/assets/js/14.5c9f8480.js"><link rel="prefetch" href="/assets/js/15.1ace2384.js"><link rel="prefetch" href="/assets/js/16.2fbfdd3f.js"><link rel="prefetch" href="/assets/js/17.7541150b.js"><link rel="prefetch" href="/assets/js/18.6db9312f.js"><link rel="prefetch" href="/assets/js/19.65b17127.js"><link rel="prefetch" href="/assets/js/20.ea752e98.js"><link rel="prefetch" href="/assets/js/21.18d93d02.js"><link rel="prefetch" href="/assets/js/22.01567462.js"><link rel="prefetch" href="/assets/js/23.9f738f3b.js"><link rel="prefetch" href="/assets/js/25.f5cbd090.js"><link rel="prefetch" href="/assets/js/26.eb2ab64e.js"><link rel="prefetch" href="/assets/js/27.1b61d7a2.js"><link rel="prefetch" href="/assets/js/28.7bb3bf3e.js"><link rel="prefetch" href="/assets/js/29.7e0fbd35.js"><link rel="prefetch" href="/assets/js/3.34967994.js"><link rel="prefetch" href="/assets/js/30.5ecf9567.js"><link rel="prefetch" href="/assets/js/31.b01d28aa.js"><link rel="prefetch" href="/assets/js/32.4516dfd8.js"><link rel="prefetch" href="/assets/js/33.bf1d893c.js"><link rel="prefetch" href="/assets/js/34.e9ee0ad9.js"><link rel="prefetch" href="/assets/js/35.1c255f63.js"><link rel="prefetch" href="/assets/js/36.f55fd62f.js"><link rel="prefetch" href="/assets/js/37.f397b124.js"><link rel="prefetch" href="/assets/js/38.4e8718a0.js"><link rel="prefetch" href="/assets/js/39.d2c8e812.js"><link rel="prefetch" href="/assets/js/4.0b272843.js"><link rel="prefetch" href="/assets/js/40.01009bac.js"><link rel="prefetch" href="/assets/js/41.e715128b.js"><link rel="prefetch" href="/assets/js/42.a97764de.js"><link rel="prefetch" href="/assets/js/43.36d17e45.js"><link rel="prefetch" href="/assets/js/44.b6827399.js"><link rel="prefetch" href="/assets/js/45.4e94dd41.js"><link rel="prefetch" href="/assets/js/46.3d381361.js"><link rel="prefetch" href="/assets/js/47.9420766b.js"><link rel="prefetch" href="/assets/js/48.77b00142.js"><link rel="prefetch" href="/assets/js/49.97c36f7d.js"><link rel="prefetch" href="/assets/js/5.805ba45a.js"><link rel="prefetch" href="/assets/js/50.cb46f41a.js"><link rel="prefetch" href="/assets/js/51.873771cb.js"><link rel="prefetch" href="/assets/js/52.ef8a3534.js"><link rel="prefetch" href="/assets/js/53.741b1340.js"><link rel="prefetch" href="/assets/js/54.eef1e2a9.js"><link rel="prefetch" href="/assets/js/55.d1b7bbb8.js"><link rel="prefetch" href="/assets/js/56.eeef2d3c.js"><link rel="prefetch" href="/assets/js/57.1a947cf4.js"><link rel="prefetch" href="/assets/js/58.0a1cada8.js"><link rel="prefetch" href="/assets/js/59.c837033a.js"><link rel="prefetch" href="/assets/js/6.f5628b95.js"><link rel="prefetch" href="/assets/js/60.a464d607.js"><link rel="prefetch" href="/assets/js/61.52fe3262.js"><link rel="prefetch" href="/assets/js/62.ed91536e.js"><link rel="prefetch" href="/assets/js/63.a6109c98.js"><link rel="prefetch" href="/assets/js/64.b088a8a8.js"><link rel="prefetch" href="/assets/js/65.e37a8912.js"><link rel="prefetch" href="/assets/js/66.459603cd.js"><link rel="prefetch" href="/assets/js/67.69a2d01f.js"><link rel="prefetch" href="/assets/js/68.553d771a.js"><link rel="prefetch" href="/assets/js/69.f2084ee9.js"><link rel="prefetch" href="/assets/js/7.73ae2e05.js"><link rel="prefetch" href="/assets/js/70.ec992f5b.js"><link rel="prefetch" href="/assets/js/71.cd143dc7.js"><link rel="prefetch" href="/assets/js/72.b3aa435a.js"><link rel="prefetch" href="/assets/js/73.726db8b5.js"><link rel="prefetch" href="/assets/js/74.850886ee.js"><link rel="prefetch" href="/assets/js/75.ef77e799.js"><link rel="prefetch" href="/assets/js/76.8d05a54c.js"><link rel="prefetch" href="/assets/js/77.10b6b8ba.js"><link rel="prefetch" href="/assets/js/78.701b66b3.js"><link rel="prefetch" href="/assets/js/79.0741bf30.js"><link rel="prefetch" href="/assets/js/8.1ce88271.js"><link rel="prefetch" href="/assets/js/80.03c767fc.js"><link rel="prefetch" href="/assets/js/81.60177e52.js"><link rel="prefetch" href="/assets/js/82.b0b5ad51.js"><link rel="prefetch" href="/assets/js/83.75cbe9ec.js"><link rel="prefetch" href="/assets/js/84.d3a08d34.js"><link rel="prefetch" href="/assets/js/85.0a363f76.js"><link rel="prefetch" href="/assets/js/86.1ea0a8df.js"><link rel="prefetch" href="/assets/js/87.038dbc33.js"><link rel="prefetch" href="/assets/js/88.32433a9f.js"><link rel="prefetch" href="/assets/js/89.b002dd69.js"><link rel="prefetch" href="/assets/js/9.7876e400.js"><link rel="prefetch" href="/assets/js/90.72b84b41.js"><link rel="prefetch" href="/assets/js/91.d83046e1.js"><link rel="prefetch" href="/assets/js/92.ab53fdbd.js"><link rel="prefetch" href="/assets/js/93.a2e71741.js"><link rel="prefetch" href="/assets/js/94.3e9a543e.js"><link rel="prefetch" href="/assets/js/95.3e77f72e.js"><link rel="prefetch" href="/assets/js/96.ba8a7553.js"><link rel="prefetch" href="/assets/js/97.6e9a670f.js"><link rel="prefetch" href="/assets/js/98.258d4cb9.js"><link rel="prefetch" href="/assets/js/99.58b4881a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7f8e66f6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">OpenMQTTGateway v1.7.0</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://shop.theengs.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Shop🆕
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://1technophile.blogspot.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/" class="nav-link">
  Docs
</a></div><div class="nav-item"><a href="https://community.openmqttgateway.com" target="_self" class="nav-link external">
  Community
  <!----></a></div><div class="nav-item"><a href="https://compatible.openmqttgateway.com/index.php/devices" target="_self" class="nav-link external">
  Devices
  <!----></a></div><div class="nav-item"><a href="/upload/web-install.html" class="nav-link">
  Upload
</a></div><div class="nav-item"><a href="https://app.theengs.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Theengs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/1technophile/OpenMQTTGateway" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://shop.theengs.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Shop🆕
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://1technophile.blogspot.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/" class="nav-link">
  Docs
</a></div><div class="nav-item"><a href="https://community.openmqttgateway.com" target="_self" class="nav-link external">
  Community
  <!----></a></div><div class="nav-item"><a href="https://compatible.openmqttgateway.com/index.php/devices" target="_self" class="nav-link external">
  Devices
  <!----></a></div><div class="nav-item"><a href="/upload/web-install.html" class="nav-link">
  Upload
</a></div><div class="nav-item"><a href="https://app.theengs.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Theengs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/1technophile/OpenMQTTGateway" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">0 - What is it for 🏠</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>1 - Prerequisites🧭</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>2 - Set it up 🔨</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>3 - Upload ➡️</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/upload/web-install.html" class="sidebar-link">(Option 1) Upload from the web</a></li><li><a href="/upload/binaries.html" class="sidebar-link">(Option 2) Upload ready-to-go binaries</a></li><li><a href="/upload/builds.html" class="sidebar-link">(Option 3) Upload your configurations</a></li><li><a href="/upload/gitpod.html" class="sidebar-link">(Option 4) Build from the web</a></li><li><a href="/upload/portal.html" class="sidebar-link">Wifi and MQTT configuration</a></li><li><a href="/upload/advanced-configuration.html" aria-current="page" class="active sidebar-link">Advanced configuration of the gateway</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/upload/advanced-configuration.html#secure-connection-to-the-broker" class="sidebar-link">Secure connection to the broker</a></li><li class="sidebar-sub-header"><a href="/upload/advanced-configuration.html#add-the-received-value-at-the-end-of-the-topic" class="sidebar-link">Add the received &quot;value&quot; at the end of the topic</a></li><li class="sidebar-sub-header"><a href="/upload/advanced-configuration.html#auto-discovery" class="sidebar-link">Auto discovery</a></li></ul></li><li><a href="/upload/troubleshoot.html" class="sidebar-link">Troubleshooting</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>4 - Use ✈️</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>5 - Integrate 🎉</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>6 - Participate 💻</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="advanced-configuration-of-the-gateway"><a href="#advanced-configuration-of-the-gateway" class="header-anchor">#</a> Advanced configuration of the gateway</h1> <h2 id="secure-connection-to-the-broker"><a href="#secure-connection-to-the-broker" class="header-anchor">#</a> Secure connection to the broker</h2> <p>By default the connection between the gateway and the MQTT broker is not encrypted and the identity of the broker is not verified.
For connections in a private local area network this might not be a big issue, but if you connect to a broker on the internet or the gateway is connected to a public network there is a high security risk.</p> <p>To secure the connection, Transport Layer Security (TLS) can be used which is supported by most MQTT brokers.
Setting up and configuring TLS in the MQTT broker is a complex process and perhaps include creating a self-signed certificate.
The configuration of the broker is not covered here, you should look into the documentation of your broker.</p> <h3 id="prerequisites"><a href="#prerequisites" class="header-anchor">#</a> Prerequisites</h3> <p>The MQTT broker is configured for TLS and you have access to the CA certificate which was used to sign the MQTT broker certificate.
You are using ESP8266 or ESP32, for other boards TLS is not supported.</p> <h3 id="configure-secure-connection-in-the-gateway"><a href="#configure-secure-connection-in-the-gateway" class="header-anchor">#</a> Configure secure connection in the gateway</h3> <p>To enable the secure connection and use TLS set the <code>#define MQTT_DEFAULT_SECURE</code> to true.
Set <code>MQTT_SERVER</code> to the Common Name (CN) of the certificate of the broker.
This can be the hostname or the IP of the broker.</p> <p>The CA certificate should be in PEM ascii format.
If your CA certificate is not in the correct format or you don't know the format, use <code>openssl</code> to convert the certificate to the correct format.
In <code>User_config.h</code> replace the <code>...</code> with the content of your certificate which is between the <code>-----BEGIN CERTIFICATE-----</code> and <code>-----END CERTIFICATE-----</code> lines:</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> certificate CERT_ATTRIBUTE <span class="token operator">=</span> <span class="token raw-string string">R&quot;EOF(&quot;
-----BEGIN CERTIFICATE-----
...
-----END CERTIFICATE-----
&quot;)EOF&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>You can know compile and upload to your board and the gateway should connect with TLS to your broker.</p> <h2 id="add-the-received-value-at-the-end-of-the-topic"><a href="#add-the-received-value-at-the-end-of-the-topic" class="header-anchor">#</a> Add the received &quot;value&quot; at the end of the topic</h2> <p>For the gateways that publish a &quot;value&quot; parameter on the json (RF, IR...), it is possible to concatenate this parameter at the end of the topic.
So as to activate this function you need to set <code>valueAsATopic</code> to true in User_config.h</p> <div class="language-cpp line-numbers-mode"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">valueAsATopic</span></span>
<span class="token macro property"><span class="token directive-hash">#</span>  <span class="token directive keyword">define</span> <span class="token macro-name">valueAsATopic</span> <span class="token expression"><span class="token boolean">false</span> </span><span class="token comment">// define true to integrate msg value into the subject when receiving</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Per default you see the following data:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>home/OpenMQTTGateway/SRFBtoMQTT {&quot;raw&quot;:&quot;2B660186042E00E7E5&quot;,&quot;value&quot;:&quot;59365&quot;,&quot;delay&quot;:&quot;1111&quot;,&quot;val_Thigh&quot;:&quot;390&quot;,&quot;val_Tlow&quot;:&quot;1070&quot;}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>With the line uncommented you will see:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>home/OpenMQTTGateway/SRFBtoMQTT/59365 {&quot;raw&quot;:&quot;2B660186042E00E7E5&quot;,&quot;value&quot;:&quot;59365&quot;,&quot;delay&quot;:&quot;1111&quot;,&quot;val_Thigh&quot;:&quot;390&quot;,&quot;val_Tlow&quot;:&quot;1070&quot;}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>It can be useful to avoid warning or errors on certain controllers.</p> <h2 id="auto-discovery"><a href="#auto-discovery" class="header-anchor">#</a> Auto discovery</h2> <p>Home Assistant discovery is enabled by default on all binaries and platformio configurations except for UNO. With Arduino IDE you have to uncomment <a href="https://github.com/1technophile/OpenMQTTGateway/blob/0180a0dbd55ed8e0799e30ee84f68070a6f478fa/User_config.h#L99" target="_blank" rel="noopener noreferrer">ZmqttDiscovery<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> in User_config.h.</p> <p>To have a working discovery setup you need to enable it on your MQTT integration definition in HASS.</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>With platformio you can deactivate discovery by adding:</p> <div class="language-ini line-numbers-mode"><pre class="language-ini"><code><span class="token key attr-name">'-UZmqttDiscovery</span><span class="token punctuation">=</span><span class="token value attr-value">&quot;HADiscovery&quot;'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>To your environment definition.</p></div> <p>So as to create the MQTT username and password, you have to create a new user(recommended) into Home Assistant-&gt;Configuration-&gt;Users (available in admin mode) or use an existing username/pwd combination (not recommended). This user doesn't need to be an administrator.</p> <p><img src="/assets/img/OpenMQTTGateway-Configuration-Home-Assistant.3ca02117.png" alt="MQTT User"></p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>The max size of the username is 30 and 60 for the password.</p></div> <p>OMG will use the auto discovery functionality of home assistant to create sensors and gateways into your HASS instance automatically.</p> <p>The gateway device will be available into Configuration-&gt;Devices section of Home Assistant.</p> <p><img src="/assets/img/OpenMQTTGateway_Home_Assistant_MQTT_discovery.e0225c4f.png" alt="MQTT Device settings"></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/1technophile/OpenMQTTGateway/edit/development/docs/upload/advanced-configuration.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">12/14/2023, 4:43:29 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/upload/portal.html" class="prev">
        Wifi and MQTT configuration
      </a></span> <span class="next"><a href="/upload/troubleshoot.html">
        Troubleshooting
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.7095c86b.js" defer></script><script src="/assets/js/2.fdf4d158.js" defer></script><script src="/assets/js/24.6de3bada.js" defer></script>
  </body>
</html>
